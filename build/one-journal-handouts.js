!function(){"use strict";const e={MODULE_NAME:"one-journal-handouts",MODULE_TITLE:"One Journal Handouts"};e.PATH=`modules/${e.MODULE_NAME}/`;const n="gm-journal",t="players-journal",a="open-page",s=()=>{const e={};for(const[n,t]of game.journal.entries())e[n]=t.name.length>30?`${t.name.slice(0,30)}...`:t.name;return e},i="open-page",o=(n,t)=>{game.socket.emit(`module.${e.MODULE_NAME}`,{event:i,journalId:n.id,pageId:t}),game.settings.get(e.MODULE_NAME,a)&&n.sheet.render(!0,{pageId:t,sheetMode:JournalSheet.VIEW_MODES.SINGLE})};new class{constructor(){this.init()}init(){Hooks.once("init",(()=>{console.log(`${e.MODULE_TITLE} | Initializing module`),game.settings.register(e.MODULE_NAME,n,{name:game.i18n.localize(`${e.MODULE_NAME}.settings.${n}-name`),hint:game.i18n.localize(`${e.MODULE_NAME}.settings.${n}-hint`),scope:"world",config:!0,default:null,type:String,choices:()=>foundry.utils.mergeObject({all:game.i18n.localize("all")},s())}),game.settings.register(e.MODULE_NAME,t,{name:game.i18n.localize(`${e.MODULE_NAME}.settings.${t}-name`),hint:game.i18n.localize(`${e.MODULE_NAME}.settings.${t}-hint`),scope:"world",config:!0,default:null,type:String,choices:s}),game.settings.register(e.MODULE_NAME,a,{name:game.i18n.localize(`${e.MODULE_NAME}.settings.${a}-name`),hint:game.i18n.localize(`${e.MODULE_NAME}.settings.${a}-hint`),scope:"world",config:!0,default:!0,type:Boolean}),game.socket.on(`module.${e.MODULE_NAME}`,(({event:e,journalId:n,pageId:t})=>{if(e!==i)return;const a=game.journal.get(n);a&&a.sheet.render(!0,{pageId:t,sheetMode:JournalSheet.VIEW_MODES.SINGLE})})),Hooks.on("getJournalSheetHeaderButtons",((a,s)=>{if(!game.users.current.isGM)return;const i=game.settings.get(e.MODULE_NAME,n),l=game.settings.get(e.MODULE_NAME,t);if(i&&l&&!s.find((n=>n.class===e.MODULE_NAME))&&a instanceof DocumentSheet){if("all"===i&&a.document.id===l)return;if("all"!==i&&a.document.id!==i)return;s.unshift({icon:"fas fa-square-share-nodes fa-fw",label:`${e.MODULE_NAME}.share-with-players`,class:e.MODULE_NAME,onclick:async()=>{const n=game.journal.get(l);if(!n)return ui.notifications.error(game.i18n.localize(`${e.MODULE_NAME}.no-players-journal`));const t=a.pagesInView[0]?.dataset?.pageId;if(!t)return;const s=n.pages.find((n=>n.flags?.[e.MODULE_NAME]===t));if(s)o(n,s.id);else{const s=await(async(n,t,a)=>{const s=Object.assign({},n.document.pages.find((e=>e.id===t)).toObject());foundry.utils.setProperty(s,`flags.${e.MODULE_NAME}`,t);const i=a.pages.map((e=>e.sort)),o=i.length?Math.max(...i):0;s.sort=o+1e4;const[l]=await a.createEmbeddedDocuments("JournalEntryPage",[s]);return l})(a,t,n);o(n,s.id)}ui.notifications.info(game.i18n.localize(`${e.MODULE_NAME}.successful`))}})}}))}))}}}();